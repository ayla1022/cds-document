---
title: 负载均衡配置相关  
date: 2021-11-23 09:11:00
permalink: /pages/1233048/
article: true
---

##### 四层负载均衡与七层负载均衡有什么区别？

- 四层是基于二元组IP + 端口的负载均衡。
- 七层是基于应用层信息（如 HTTP 头部、URL、域名、cookie等）的负载均衡。

###### 四层负载均衡

在三层负载均衡的基础上，用 IP + 端口 接收请求，即主要通过报文中的目标地址和端口，再加上负载均衡设置的调度算法选择已注册后端云服务器并转发流量。
例如，四层的负载均衡，就是通过发布三层的IP地址（VIP），然后加四层的端口号，来决定哪些流量需要做负载均衡，对需要处理的流量进行 NAT 处理，转发至后台服务器，并记录下这个 TCP 或者 UDP 的流量是由哪台服务器处理的，后续这个连接的所有流量都同样转发到同一台服务器处理。

###### 七层的负载均衡

主要通过报文中的真正有意义的应用层内容，再加上负载均衡设置的调度算法，决定最终选择的后端服务器。
例如，同一个 Web 服务器的负载均衡，除了根据 VIP 和80端口辨别是否需要处理的流量，还可根据七层的 URL、浏览器类别、语言来决定是否要进行负载均衡。举个例子，如果你的 Web 服务器分成两组，一组是中文语言的，一组是英文语言的，那么七层负载均衡就可以当用户来访问你的域名时，自动辨别用户语言，然后选择对应的语言服务器组进行负载均衡处理

##### 四层和七层对比表格

| 项目     | 四层负载均衡(layer 4) | 七层负载均衡(layer 7)                              |
| -------- | --------------------- | -------------------------------------------------- |
| 转发     | IP + 端口             | 虚拟的URL或者请求头中的Host                        |
| 复杂度   | 低                    | 高                                                 |
| 性能     | 高，不需要解析内容    | 中：需要识别证书、Cookie、HTTP头等信息             |
| 额外功能 | 无                    | 基于Cookie会话保持、图片压缩、域名转发、证书等功能 |

