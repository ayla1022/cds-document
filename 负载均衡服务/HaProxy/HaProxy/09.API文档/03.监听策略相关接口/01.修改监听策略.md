### 修改监听策略

#### 1.接口描述

**Action:** ModifyLoadBalancerStrategys

**描述:** 修改（删除、修改、添加）Ha实例的当前监听的策略配置列表

**请求地址:** cdsapi.capitalonline.net/lb

**请求方法:** POST

#### 2.请求参数

| 参数名             | 必选 | 类型   | 说明                                                         |
| ------------------ | ---- | ------ | ------------------------------------------------------------ |
| InstanceUuid       | 是   | string | 要修改的实例编号                                             |
| HttpListeners      | 是   | list   | http 监听策略配置列表                                        |
| TcpListeners       | 是   | list   | tcp 的监听策略列表                                           |
| EnableSourceIp     | 否   | string | 设置获取源IP。取值范围【"on","off"】，默认为off              |
| EnableRepeaterMode | 否   | string | 设置当前Haproxy为中继默认且支持源IP透传。取值范围 【"on","off"】，默认为off，注意：如果设置了EnableRepeaterMode为on，则EnableSourceIp参数也必须为on |
| ServerTimeoutUnit  | 是   | string | 设置服务端超时时间单位 【"ms","s"】                          |
| ServerTimeout      | 是   | string | 设置服务端超时时间                                           |
| StickySession      | 是   | string | 是否开启回话保持 【"on","off"】                              |
| AclWhiteList       | 是   | list   | 设置白名单 例如【"129.12.12.1"，"192.168.1.1/20"】           |
| CertificateIds     | 是   | list   | http 监听可以绑定证书，不绑定传空列表                        |
| CertificateId      | 否   | string | 证书编号                                                     |
| CertificateName    | 否   | string | 证书名称                                                     |
| ListenerMode       | 是   | string | 监听模式                                                     |
| MaxConn            | 是   | int    | 代理端的最大连接数                                           |
| ConnectTimeoutUnit | 是   | string | 设置请求连接超时的时间单位【"ms","s"】                       |
| Scheduler          | 是   | string | 调度算法【"roundrobin", "leastconn", "static-rr", "source"】 |
| BackendServer      | 是   | list   | 后端服务器配置                                               |
| IP                 | 是   | string | 后端服务器Ip地址（公网下支持域名）                           |
| Port               | 是   | string | 后端服务器端口                                               |
| Weight             | 是   | string | 后端服务器权重，权重范围为1-256                              |
| MaxConn            | 是   | int    | 后端服务器最大连接数                                         |
| ConnectTimeout     | 是   | int    | 设置请求连接超时时间                                         |
| ClientTimeout      | 是   | int    | 设置客户端连接超时的时间                                     |
| ListenerName       | 是   | int    | 监听策略的名称，用于生成配置文件，名称不能相同               |
| ClientTimeoutUnit  | 是   | int    | 设置客户端连接超时的时间单位【"ms","s"】                     |
| ListenerPort       | 是   | int    | Ha最为代理配置的端口                                         |

#### 3.请求示例

```python
def modify_strategy(instance_uuid):
    """
    修改（删除、修改、添加）Ha实例的当前监听的策略配置列表
    :param instance_uuid: 实例id
    """
    action = "ModifyLoadBalancerStrategys"
    method = "POST"
    param = {}
    url = get_signature(action, AK, AccessKeySecret, method, HAPROXY_URL, param=param)
    body = {
            "InstanceUuid": instance_uuid,
            # "HttpListeners": [],
            "HttpListeners": [
                {
                    "ServerTimeoutUnit": "ms",
                    "ServerTimeout": "1000",
                    "StickySession": "on",
                    "AclWhiteList": [
                        "192.168.1.2"
                    ],
                    "CertificateIds": [
                        {
                            "CertificateId": "******",
                            "CertificateName": "******"
                        }
                    ],
                    "ListenerMode": "http",
                    "MaxConn": 100000,
                    "ConnectTimeoutUnit": "ms",
                    "Scheduler": "roundrobin",
                    "BackendServer": [
                        {
                            "IP": "66.66.0.8",
                            "Port": 22222,
                            "Weight": "1",
                            "MaxConn": 2222
                        }
                    ],
                    "ConnectTimeout": "1000",
                    "ClientTimeout": "1000",
                    "ListenerName": "http-test",
                    "ClientTimeoutUnit": "ms",
                    "ListenerPort": 23425
                }
            ],
             "TcpListeners": [
               {
                    "EnableSourceIp":"on",
                    "EnableRepeaterMode":"on",
                    "ServerTimeoutUnit": "ms",
                    "AclWhiteList": [],
                    "ListenerMode": "tcp",
                    "ListenerName": "tcp-test",
                    "Scheduler": "leastconn",
                    "MaxConn": 2323,
                    "ClientTimeoutUnit": "ms",
                    "ListenerPort": 2342,
                    "ServerTimeout": "10000",
                    "ConnectTimeoutUnit": "s",
                    "BackendServer": [
                         {
                             "IP": "66.66.0.8",
                             "MaxConn": 2000,
                             "Port": 2342,
                             "Weight": "1"
                         }
                     ],
                     "ConnectTimeout": "22",
                     "ClientTimeout": "10000",
                }
             ]
    }
    res = requests.post(url, json=body)
    result = json.loads(res.content)
```

#### 4.返回参数

| 参数名  | 必选 | 类型   | 说明     |
| ------- | ---- | ------ | -------- |
| Message | 是   | string | 信息描述 |
| Code    | 是   | string | 状态码   |
| Data    | 是   | dict   | 数据     |
| TaskId  | 是   | string | 任务     |

#### 5.返回示例

```python
{
    "Code": "Success",
    "Data": {},
    "Message": "Success.",
    "TaskId": "******"
}
```

