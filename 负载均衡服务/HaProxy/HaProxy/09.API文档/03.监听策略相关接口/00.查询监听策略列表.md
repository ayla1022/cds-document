---
title: 查询监听策略列表   
date: 2022-01-07 18:45:00
permalink: /pages/1233039/
article: true
---


## 1.接口描述

**Action**： DescribeLoadBalancerStrategys

**描述**： 获取Ha实例的当前监听的策略配置列表

**请求地址**： cdsapi.capitalonline.net/lb

**请求方法**： GET

## 2.请求参数

| 参数名       | 必选 | 类型   | 说明     |
| :----------- | :--- | :----- | :------- |
| InstanceUuid | 是   | string | 实例编号 |

## 3.请求示例

```python
def get_strategy_list(instance_uuid):
    """
    获取单个实例所有的策略配置
    """
    action = "DescribeLoadBalancerStrategys"
    method = "GET"
    param = {
        "InstanceUuid": "***************"
    }
    url = get_signature(action, AK, AccessKeySecret, method, HAPROXY_URL, param)
    res = requests.get(url)
    result = json.loads(res.content)
    result = json.dumps(result)  # json格式化

    print(result)
```

## 4.返回参数

| 参数名  | 类型                     | 说明     |
| :------ | :----------------------- | -------- |
| Code    | string                   | 状态码   |
| Data    | dict of [Data](#dataobj) | 数据     |
| Message | string                   | 信息描述 |

### DataObj

| 参数名        | 类型                                       | 说明                  |
| :------------ | :----------------------------------------- | --------------------- |
| HttpListeners | list of [HttpListeners](#httplistenersobj) | http 监听策略配置列表 |
| TcpListeners  | list of [TcpListeners](#tcplistenersobj)   | tcp 的监听策略列表    |

### HttpListenersObj

| 参数名             | 类型                                                   | 说明                                                         |
| :----------------- | :----------------------------------------------------- | ------------------------------------------------------------ |
| AclWhiteList       | list                                                   | 设置白名单，例如【"129.12.12.1"，"192.168.1.1/20"】          |
| BackendServer      | list of [BackendServer](#backendserverobj)             | 后端服务器配置                                               |
| CertificateIds     | list of [CertificateIds](#certificateidsobj)           | http 监听可以绑定证书，不绑定传空列表                        |
| ClientTimeout      | int                                                    | 设置客户端连接超时的时间                                     |
| ClientTimeoutUnit  | string                                                 | 设置客户端连接超时的时间单位【"ms","s"】                     |
| ConnectTimeout     | int                                                    | 设置请求连接超时时间                                         |
| ConnectTimeoutUnit | string                                                 | 设置请求连接超时时间的时间单位                               |
| ListenerMode       | string                                                 | 监听模式                                                     |
| ListenerName       | string                                                 | 监听策略的名称，用于生成配置文件，名称不能相同               |
| ListenerPort       | int                                                    | Ha最为代理配置的端口                                         |
| MaxConn            | int                                                    | 代理端的最大连接数                                           |
| Scheduler          | string                                                 | 调度算法【"roundrobin", "leastconn", "static-rr", "source"】 |
| ServerTimeout      | int                                                    | 设置服务端超时时间                                           |
| ServerTimeoutUnit  | string                                                 | 设置服务端超时时间单位 【"ms","s"】                          |
| SessionPersistence | object of [SessionPersistence](#sessionpersistenceobj) | 设置会话保持功能                                             |
| StickySession      | string                                                 | 是否开启长连接（Keep Alive）  【"on","off"】                 |

### TcpListenersObj

| 参数名             | 类型                                       | 说明                                                         |
| :----------------- | :----------------------------------------- | ------------------------------------------------------------ |
| AclWhiteList       | list                                       | 设置白名单，例如【"129.12.12.1"，"192.168.1.1/20"】          |
| BackendServer      | list of [BackendServer](#backendserverobj) | 后端服务器配置                                               |
| ClientTimeout      | int                                        | 设置客户端连接超时的时间                                     |
| ClientTimeoutUnit  | string                                     | 设置客户端连接超时的时间单位【"ms","s"】                     |
| ConnectTimeout     | int                                        | 设置请求连接超时时间                                         |
| ConnectTimeoutUnit | string                                     | 设置请求连接超时时间的时间单位                               |
| EnableSourceIp     | string                                     | 是否开启获取源IP 【"on","off"】                              |
| EnableRepeaterMode | string                                     | 是否当前Haproxy为中继默认且支持源IP透传 【"on","off"】       |
| ListenerMode       | string                                     | 监听模式                                                     |
| ListenerName       | string                                     | 监听策略的名称，用于生成配置文件，名称不能相同               |
| ListenerPort       | int                                        | Ha最为代理配置的端口                                         |
| MaxConn            | int                                        | 代理端的最大连接数                                           |
| Scheduler          | string                                     | 调度算法【"roundrobin", "leastconn", "static-rr", "source"】 |
| ServerTimeout      | int                                        | 设置服务端超时时间                                           |
| ServerTimeoutUnit  | string                                     | 设置服务端超时时间单位 【"ms","s"】                          |

### BackendServerObj

| 参数名  | 类型   | 说明                 |
| :------ | :----- | -------------------- |
| IP      | string | 后端服务器Ip地址     |
| MaxConn | int    | 后端服务器最大连接数 |
| Port    | string | 后端服务器端口       |
| Weight  | string | 后端服务器权重       |

### CertificateIdsObj

| 参数名          | 类型 | 说明     |
| :-------------- | :--- | -------- |
| CertificateId   | list | 证书编号 |
| CertificateName | list | 证书名称 |

### SessionPersistenceObj

| 参数名 | 必选 | 类型                         | 说明                                                         |
| :----- | :--- | :--------------------------- | ------------------------------------------------------------ |
| Key    | 是   | string                       | 在http的reponse设置Cookie的Key的值。字符长度为2~15,以字母开头，以字母或数字结尾,由小写字母、数字或下划线组成, key要求唯一。 |
| Mode   | 否   | int                          | 默认值为1。<br />0. 表示在缓存中 ( 例如：CDN ) 保留Cookie的内容 <br />1. 表示不在缓存中 ( 例如：CDN ) 保留Cookie的内容, 负载均衡设置的cookie在后端服务可见。<br />2. 表示不在缓存中 ( 例如：CDN ) 保留Cookie的内容, 负载均衡设置的cookie在后端服务是不可见,即透明模式只能看到客户自己设置的Cookie。 |
| Timer  | 否   | object of [Timer](#timerobj) | 设置会话保持的时间参数，单位: 秒。                           |

### TimerObj

| 参数名  | 必选 | 类型 | 说明                                                         |
| :------ | :--- | :--- | ------------------------------------------------------------ |
| MaxIdle | 是   | int  | 默认值为0, 表示不设置，即空闲也会会话保持。<br />单位: 秒。支持范围：0-7200。<br />设置会话保持的最大空闲时长，当连接在该时长内无新的请求，则会话保持结束。 |
| MaxLife | 是   | int  | 默认值为0，表示不设置，即会话会一直保持。<br /> 单位: 秒。支持范围：0-7200。<br />设置会话保持的最大时长，超过该时长则会话保持结束, 且要求maxlife 大于maxidle。 |

## 5.返回示例

```python
{
    "Code": "Success",
    "Data": {
        "HttpListeners": [{
            "AclWhiteList": ["192.168.1.2"],
            "BackendServer": [{
                "IP": "88.88.0.9",
                "MaxConn": 2222,
                "Port": 22221,
                "Weight": "29"
            }],
            "CertificateIds": [{
                "CertificateId": "*****************",
                "CertificateName": "证书oXDYdSgK"
            }],
            "ClientTimeout": "1000",
            "ClientTimeoutUnit": "ms",
            "ConnectTimeout": "1000",
            "ConnectTimeoutUnit": "ms",
            "ListenerMode": "http",
            "ListenerName": "http34",
            "ListenerPort": 23425,
            "MaxConn": 100000,
            "Scheduler": "roundrobin",
            "ServerTimeout": "1002",
            "ServerTimeoutUnit": "ms",
            "SessionPersistence": {
                "Key": "test123",
                "Mode": 2,
                "Timer": {
                    "MaxIdle": 3333,
                    "MaxLife": 3444
                }
            },
            "StickySession": "on"
        }],
        "TcpListeners": [{
            "AclWhiteList": [],
            "BackendServer": [{
                "IP": "88.88.0.9",
                "MaxConn": 2000,
                "Port": 2341,
                "Weight": "256"
            }],
            "ClientTimeout": "1010",
            "ClientTimeoutUnit": "ms",
            "ConnectTimeout": "22",
            "ConnectTimeoutUnit": "s",
            "EnableRepeaterMode": "on",
            "EnableSourceIp": "on",
            "ListenerMode": "tcp",
            "ListenerName": "http343",
            "ListenerPort": 2343,
            "MaxConn": 2323,
            "Scheduler": "leastconn",
            "ServerTimeout": "10000",
            "ServerTimeoutUnit": "ms"
        }]
    },
    "Message": "success",
    "TaskId": ""
}
```

