---
title: 修改自定义配置文件   
date: 2022-07-25 18:45:00
permalink: /pages/1233062/
article: true
---


## 1.接口描述

**Action**： ModifyHaproxyCustomConfig

**描述**： 修改负载均衡自定义配置策略的配置文件

**请求地址**： cdsapi.capitalonline.net/lb

**请求方法**： POST

## 2.请求参数
| 参数名       | 必选 | 类型   | 说明             |
| :----------- | :--- | :----- | ---------------- |
| InstanceUuid | 是   | string | 要修改的实例编号 |
| Configs      | 是   | string | 实例配置文件     |

## 3.请求示例

```python
def custom_modify_strategy(instance_uuid):
    """
    修改Ha实例的自定义监听策略配置
    :param instance_uuid: 实例id
    """
    action = "ModifyHaproxyCustomConfig"
    method = "POST"
    param = {}
    url = get_signature(action, AK, AccessKeySecret, method, HAPROXY_URL, param=param)
    body = {
        "InstanceUuid": instance_uuid,
        "Configs": "global\n        log 127.0.0.1   local0\n        chroot /var/lib/haproxy\n        stats socket /run/haproxy/admin.sock mode 660 level admin  expose-fd listeners\n        stats timeout 30s\n        user haproxy\n        group haproxy\n        #maxconn 200000\n        maxconn 150000\n        nbproc 1\n        nbthread 2\n        tune.ssl.default-dh-param 2048\n        daemon\n        hard-stop-after 5s\n        ssl-default-bind-options ssl-min-ver TLSv1.0\n\ndefaults\n        log     global\n        log-format %ci:%cp\\ [%t]\\ %ft\\ %b/%s\\ %Tq/%Tw/%Tc/%Tr/%Tt\\ %ST\\ %B\\ %CC\\ %CS\\ %tsc\\ %ac/%fc/%bc/%sc/%rc\\ %sq/%bq\\ %hr\\ %hs\\ %{+Q}r\n        mode    http\n        option  httplog\n        option tcplog\n        option abortonclose\n        option httpclose\n        option forwardfor\n        maxconn 5000\n        #websocket\n        timeout tunnel 1h\n        timeout client-fin 30s\n\nlisten status\n     bind 127.0.0.1:1081\n     mode http\n     log global\n     stats refresh 30s\n     stats uri /admin?stats\n     stats realm Private lands\n     stats auth admin:h0jMl0ka0df71WGI1\n     stats hide-version\n     timeout connect 5000ms\n     timeout client  5000ms\n     timeout server  5000ms\n     option accept-invalid-http-response\n\n\n\nfrontend ng80\n    default_backend ng80-abk\n    compression algo gzip\n    bind 0.0.0.0:80\n    http-response add-header Connection keep-alive\n    http-request set-header http_x_forwarded_proto http\n    http-request set-header X-Forwarded-Proto http\n    http-request set-header X-Forwarded-Port %[dst_port]\n    http-request set-header X-Forwarded-Client-srcport %[src_port]\n    mode http\n    timeout client 12333ms\n    maxconn 150\n    option accept-invalid-http-request\n    \n\nbackend ng80-abk\n    balance roundrobin\n    fullconn 2000\n    timeout connect 12333ms\n    timeout server 12333ms\n    server s10.240.104.24:80 10.240.104.24:80 maxconn 2220 weight 1 check\n\n\nfrontend ng801\n    default_backend ng801-abk\n    compression algo gzip\n    bind 0.0.0.0:88\n    http-response add-header Connection keep-alive\n    http-request set-header http_x_forwarded_proto http\n    http-request set-header X-Forwarded-Proto http\n    http-request set-header X-Forwarded-Port %[dst_port]\n    http-request set-header X-Forwarded-Client-srcport %[src_port]\n    mode http\n    timeout client 12333ms\n    maxconn 150\n    option accept-invalid-http-request\n    \n\nbackend ng801-abk\n    balance roundrobin\n    fullconn 2000\n    timeout connect 12333ms\n    timeout server 12333ms\n    server s10.240.104.24:80 10.240.104.24:80 maxconn 2220 weight 1 check\n\n\n\n\n"
    }
    res = requests.post(url, json=body)
    result = json.loads(res.content)
    print(result)
```

## 4.返回参数

| 参数名  | 必选 | 类型   | 说明     |
| :------ | :--- | :----- | :------- |
| Message | 是   | string | 信息描述 |
| Code    | 是   | string | 状态码   |
| Data    | 是   | dict   | 数据     |
| TaskId  | 是   | string | 任务     |

## 5.返回示例

```json
{
    "Code": "Success",
    "Data": {},
    "Message": "The policy modification task is successfully delivered. Wait until the task is executed.",
    "TaskId":"******************"
}
```

