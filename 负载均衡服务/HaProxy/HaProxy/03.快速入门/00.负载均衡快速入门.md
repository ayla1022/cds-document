---
title: 负载均衡快速入门 
date: 2021-11-17 16:45:01
permalink: /pages/1233010/
article: true
---


本文旨在介绍负载均衡 HaProxy 的入门操作，通过本文您可以快速了解如何创建并使用 HaProxy 实例。

#### 前提条件

1. 已创建两个云服务器实例。本示例创建的两台云服务器名称为 `HaProxy后端服务器1` 、`HaProxy后端服务器2`
2. 已在后端服务器上搭建好服务。本示例为 HTTP 协议类型的监听策略，对后端的两台服务器进行请求转发。两台服务器均已部署 Nginx 服务器。部署 Nginx 介绍详情参见 [Ubuntu下部署 Nginx](F:\首云工作相关\PaaS产品线\弹性计算产品\负载均衡\用户操作手册\HaProxy\03.快速入门\01.Ubuntu 下部署 Nginx.md)。

#### 一、购买负载均衡 HaProxy 实例

1. 进入 [负载均衡控制台](https://console.capitalonline.net/loadbalancers)，点击右上角创建负载均衡服务，选择 HaProxy 进入创建页。
2. 再 HaProxy 创建页，选择与云服务器相同的 VDC，选择网络处开启公网。更多创建参数介绍，详情参考 [创建负载均衡实例](F:\首云工作相关\PaaS产品线\弹性计算产品\负载均衡\用户操作手册\HaProxy\04.操作指南\00.负载均衡实例\00.创建负载均衡实例.md)。
3. 检查配置无误后，点击 **创建** 。
4. 返回负载均衡控制台实例列表页，即可看到新创建的负载均衡 HaProxy 实例。

![控制台查看实例](../pic/console-view.png)

#### 二、配置监听策略

1. 进入 [负载均衡控制台](https://console.capitalonline.net/loadbalancers)。

2. 在负载均衡 HaProxy 详情页中点击策略配置。

3. 在策略配置页签中，点击 **添加策略**。

   ![添加策略](../pic/add-policy.png)

4. 在添加策略页面中，选择协议类型为 HTTP，并配置策略配置名称与代理端口。

   ![策略名称及端口](../pic/policy-port.png)

5. 在后端服务器设置中，点击 **添加服务器**。

   ![后端服务器设置](../pic/realserver-set.png)

6. 在添加服务器弹窗中，选择创建好的云服务器，设置云服务器的端口为“80”，权重默认为1。确认无误后，点击确认。

   ![添加服务器](../pic/add-server.png)

7. 增加或修改策略配置会重启负载均衡的服务，确认配置无误后，点击确认。

#### 三、验证负载均衡服务

1. 进入 [负载均衡控制台](https://console.capitalonline.net/loadbalancers)，在基本信息页中查看服务信息里**连接服务IP**，即负载均衡 HaProxy 实例的 VIP 地址。

   ![查看VIP](../pic/view-vip.png)

2. 在 Windows 系统中，进入 `C:\Windows\System32\drivers\etc` 目录，修改 hosts 文件，把域名映射到负载均衡 HaProxy 实例的公网 VIP 上。

   ![配置host](../pic/set-realserver.png)

3. 在浏览器中访问 `www.haproxy.demo.com`，测试负载均衡服务。若如下图所示，则表示本次请求被负载均衡 HaProxy  转发到了 `HaProxy后端服务器1` 这台云服务器上，云服务器正常处理请求并返回页面。

   ![VIP访问1](../pic/vip1.png)

4. 此监听策略的调度算法是“简单轮询”，即每个服务器根据权重轮流使用。由于两台云服务器的权重都是“1”。刷新浏览器，再次发送请求，若如下图所示，则表示本次请求被负载均衡 HaProxy 转发到了 `HaProxy后端服务器2` 这台云服务器上。

   ![VIP访问1](../pic/vip2.png)
