### 实例无法连接

#### 导致问题原因

##### 1、地域不同导致

云主机实例和RDS实例位于不同的地域时，无法直接通过内网互通。

**解决办法一：**将原实例申请退款，重新购买。

**解决办法二：**通过外网互通。这种方式的性能、安全性、稳定性较差。

##### 2、IP白名单设置有误导致

**解决方法一：**由于白名单设置中只有默认地址127.0.0.1。该地址表示不允许任何设备访问RDS实例。因此需在白名单中添加对端的IP地址。

**解决方法二：**白名单设置成了0.0.0.0，正确格式为0.0.0.0/0。
说明：0.0.0.0/0表示允许任何设备访问RDS实例，请谨慎使用。

##### 3、连接数已满导致

连接数满通常是由于空闲连接过多或活动连接过多，连接数满会导致客户端无法连接到RDS for MySQL数据库。原因如下：

- 应用使用长连接模式：对于长连接模式（比如Java应用），应用侧应该配置连接池。连接池的初始连接数设置过高，应用启动后建立多个到RDS实例空闲连接。
- 应用使用短连接模式：对于短连接模式（比如PHP应用），出现大量的空闲连接说明应用没有在查询执行完毕后显式的关闭连接。

##### 解决方法：

- 通过kill命令来终止当前空闲会话。
- 修改应用，长连接模式需要启用连接池的复用功能（建议也启用连接检测功能）。
- 修改应用，短连接模式需要在代码中修改查询结束后调用关闭连接的方法。

#### 无法连接 MySQL 实例的常见报错和解决办法

| 错误信息                                                     | 原因             | 解决办法                                                     |
| ------------------------------------------------------------ | ---------------- | ------------------------------------------------------------ |
| ERROR 2003 (HY000): Can’t connect to MySQL server on ‘XXX’(10038或10060或110)无法连接到数据库：XXX | 网络互通问题     | 云主机通过内网无法访问RDS的解决办法：检查云主机和 MySQL 是否位于不同的地域。检查云主机的内网IP地址是否已添加到RDS的白名单。如果未添加，请设置白名单。云主机以外的设备无法访问RDS的解决办法：检查是否已设置RDS白名单。如果未设置，请设置白名单。如果您已设置白名单，那么连接失败很可能是因为您在白名单中添加的设备公网IP地址并非设备真正的出口IP地址。原因如下：公网IP地址不固定，可能会变动。IP地址查询工具或网站查询的公网IP地址不准确。关于确认设备公网IP地址的方法，请参见定位本地IP。 |
| ERROR 1045 (HY000): #28000ip not in whitelistERROR 2801 (HY000): #RDS00ip not in whitelist, client ip is XXX | 白名单设置问题   | 白名单中只有默认地址127.0.0.1。该地址表示不允许任何设备访问 MySQL 实例。需在白名单中添加设备的IP地址，具体操作请参见设置白名单。白名单设置成了0.0.0.0。正确格式为0.0.0.0/0您在白名单中添加的设备公网IP地址可能并非设备真正的出口IP地址。原因如下：公网IP地址不固定，可能会变动。IP地址查询工具或网站查询的公网IP地址不准确。 |
| ERROR 1045 (28000): Access denied for user ‘XXX’@’XXX’ (using password: YES或NO) | 用户名或密码错误 | 一般都是因为用户名或密码错误，请检查连接信息中的用户名和密码。MySQL 不提供root账号，您需要自行创建账号。具体操作请参见[创建账号](http://wiki-private.capitalonline.net:8090/pages/viewpage.action?pageId=75827069)。如果密码中包含特殊字符，可能需要加上单引号，例如，在命令中使用-p '密码'。如果忘记密码，您可以在控制台的账号管理页面修改密码。 修改密码后，新密码可能需要数分钟才生效。类似的错误信息：连接RDS for MySQL实例时，提示以下错误信息：ERROR 1045 (28000): Access denied for user ‘XXX’@’XXX’ (using password: NO)原因：连接信息中没有填写密码。 |
