---
title: 读写数据库
date: 2021-12-06 17:00:00
permalink: /pages/746019/
article: true
---

### 读写数据库

#### 操作场景

连接到云数据库 MongoDB 后，您可以创建数据库，并进行写入操作。

#### 创建数据库

创建数据库的语法如下：

```
use databasename
```

创建一个名为 database_test 的数据库，并插入文档。

```
> use database_test
switched to db database_test
> db.database_test.insert({"test":"database_test"})
WriteResult({ "nInserted" : 1 })
```

查询创建的数据库。

```
> show dbs
admin      0.000GB
config     0.000GB
local      0.041GB
database_test  0.000GB
```

#### 创建集合

创建集合的语法如下：

```
db.createCollection(name, options)
```

##### 参数说明

+ name：集合的名称。
+ options：可选参数，用于指定有关内存大小及索引的选项。
  + capped：BOOL 类型，指是否设置集合的最大字节数。如果为 true，需设置 size 参数。默认为 false。
  + autoIndexId：BOOL 类型，设置是否自动创建索引。如为 true，自动在 _id 字段创建索引。默认为 false。
  + size：数值类型，设置集合的最大字节数。
  + max：数值类型，设置集合包含文档的最大数量。

在 database_test 数据库中创建 test 集合示例：

```
> use database_test
switched to db database_test
> db.createCollection("test")
{
        "ok" : 1,
        "$clusterTime" : {
                "clusterTime" : Timestamp(1634821900, 2),
                "signature" : {
                        "hash" : BinData(0,"WFu7yj8wjeUBWG3b+oT84Q8wIw8="),
                        "keyId" : NumberLong("6990600483068968961")
                }
        },
        "operationTime" : Timestamp(1634821900, 2)
}
```

查询创建的集合。

```
> show collections
test
```

创建集合 test，最大字节数为 6142800B，文档最大个数为 10000 个，示例如下：

```
> db.createCollection("test", { capped : true, autoIndexId : true, size : 6142800, max : 10000 } )
{
        "note" : "the autoIndexId option is deprecated and will be removed in a future release",
        "ok" : 1,
        "$clusterTime" : {
                "clusterTime" : Timestamp(1634821879, 1),
                "signature" : {
                        "hash" : BinData(0,"EuIbp2fu9Yh38HOBHLgYqljdKaE="),
                        "keyId" : NumberLong("6990600483068968961")
                }
        },
        "operationTime" : Timestamp(1634821879, 1)
}
```

#### 插入文档

向集合插入文档的语法如下：

```
> db.test.insert({name:"张三",sex:"男",age:25,status:"X"})
WriteResult({ "nInserted" : 1 })
```

查询插入集合的文档。

```
> db.test.find()
{ "_id" : ObjectId("61716957a6fe1ef4d7eae979"), "name" : "张三", "sex" : "男", "age" : 25, "status" : "X" }
```

向集合插入一个或多个文档，语法格式如下：

```
db.collection.insertMany(
   [ <document 1> , <document 2>, ... ]
   )
```

向集合插入一个或多个文档，示例如下：

```
> db.test.insertMany([{name:"张三",sex:"男",age:25,status:"X"},{name:"李四",sex:"女",age:27,status:"Y"},{name:"王五",sex:"男",age:24,status:"Z",groups:["city","beijing"]}])
{

        "acknowledged" : true,
        "insertedIds" : [
                ObjectId("617282a3a4bb72d733b5c6d7"),
                ObjectId("617282a3a4bb72d733b5c6d8"),
                ObjectId("617282a3a4bb72d733b5c6d9")
        ]
}
```

#### 更新数据库

更新 test 集合 name 为张三的数据，示例如下：

```
> db.test.update({name:"张三",sex:"男",age:25,status:"X"},{$set:{'age':26}})
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })
```

查询修改结果。

```
> db.test.find().pretty()
{
        "_id" : ObjectId("618904b6258a6c38daf13abd"),
        "name" : "张三",
        "sex" : "男",
        "age" : 26,
        "status" : "X"
}
{
        "_id" : ObjectId("618904b6258a6c38daf13abe"),
        "name" : "李四",
        "sex" : "女",
        "age" : 27,
        "status" : "Y"
}
{
        "_id" : ObjectId("618904b6258a6c38daf13abf"),
        "name" : "王五",
        "sex" : "男",
        "age" : 24,
        "status" : "Z",
        "groups" : [
                "city",
                "北京"
        ]
}
```

#### 删除数据库

删除集合中文档的语法如下：

```
> db.test.remove({name:"张三",sex:"男",age:26,status:"X"})
WriteResult({ "nRemoved" : 1 })
```

查询删除结果。

```
> db.test.find().pretty()
{
        "_id" : ObjectId("618904b6258a6c38daf13abe"),
        "name" : "李四",
        "sex" : "女",
        "age" : 27,
        "status" : "Y"
}
{
        "_id" : ObjectId("618904b6258a6c38daf13abf"),
        "name" : "王五",
        "sex" : "男",
        "age" : 24,
        "status" : "Z",
        "groups" : [
                "city",
                "北京"
        ]
}
```

#### 更多操作

更多操作语法与示例，详情参见 [官网文档](https://docs.mongodb.com/manual/reference/connection-string/)。
